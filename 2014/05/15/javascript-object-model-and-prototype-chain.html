<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Javascript 对象模型和原型链</title>
    <meta name="viewport" content="width=device-width">

    <!-- syntax highlighting CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/main.css">

    <!-- tags css -->
    <link rel="stylesheet" href="/css/tag_cloud.css">

</head>
<body>

<div class="site">
    <div class="header">
        <h1 class="title"><a href="/">Blog Everything</a></h1>
        <a class="extra" href="/">主页</a>
    </div>

    <h2>Javascript 对象模型和原型链</h2>
<p class="meta">15 May 2014</p>

<div class="post">
    <p><center><img src="/images/javascript-object-layout.jpg" alt="prototype chain"></center></p>

<h3>重点</h3>

<ul>
<li><p>Mozilla/Konqueror/Chrome 中， 对象都有一个属性叫 <code>__proto__</code>，这个属性串起了整个原型链</p></li>
<li><p>所有构造器的实例的 <code>__proto__</code> 都指向这个构造器的 <code>prototype</code>，默认的，这个 <code>prototype</code> 对象也有个
<code>constructor</code> 属性指向构造器</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">function Person(name) {
    this.name = name
}

person = new Person(&#39;tom&#39;)
person.__proto__ == Person.prototype   // =&gt; true
person.__proto__.constructor == Person // =&gt; true
</code></pre></div></li>
<li><p><code>prototype</code> 对象只是被构造器的实例所使用 (被 <code>__proto__</code> 引用)，构造器本身并不使用这个对象的属性。但是，
构造器本身也是系统 <code>Function</code> 对象的一个实例，所以 <code>Function</code> 对象的 <code>prototype</code> 是与构造器有联系的</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">function Foo() { } ;
var f1 = new Foo();

Foo.prototype.x = &quot;hello&quot;;
f1.x    //=&gt; hello
Foo.x   //=&gt; undefined

Function.x = &#39;hello u&#39;;
Foo.x   //=&gt; hello u
</code></pre></div></li>
<li><p>构造器的 <code>prototype</code> 对象可以被替换成开发者指定的对象，这样做的时候，最好也适当的设置 <code>constructor</code> 属性</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">function foo() { } ;
var f1 = new foo();
f1.constructor === foo.prototype.constructor === foo

//replace the default prototype object
foo.prototype = new Object();

//now we have:
f1.constructor === foo.prototype.constructor === Object

//so now we say:
foo.prototype.constructor == foo

//all is well again
f1.constructor === foo.prototype.constructor === foo
</code></pre></div></li>
<li><p>每一个 <code>prototype</code> 对象本身都是 <code>Object</code> 构造器创建的一个实例，因此 <code>prototype</code> 对象的 <code>__proto__</code> 属性
指向 <code>Object</code> 的 <code>prototype</code> 对象。所以所有的实例(除了 <code>Object.prototype</code> 这个最顶层的对象) 都继承了 <code>Object.prototype</code>
对象的属性 (通过原型链继承)</p></li>
<li><p>访问对象的属性时，会先从这个对象开始，沿着原型链，直至 <code>Object.prototype</code> 这个顶层对象</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">function Foo() { }
f1 = new Foo();
f2 = new Foo();
Foo.prototype.x = &quot;hello&quot;;

f1.x  =&gt; &quot;hello&quot;
f2.x  =&gt; &quot;hello&quot;;

f1.x = &quot;goodbye&quot;;   //setting f1.x hides Foo.prototype.x

f1.x  =&gt; &quot;goodbye&quot;  //hides &quot;hello&quot; for f1 only
f2.x  =&gt; &quot;hello&quot;

delete f1.x
f1.x  =&gt; &quot;hello&quot;;   //Foo.prototype.x is visible again to f1.

Foo.prototype.x = &quot;goodbye&quot;;
//now
f1.x  =&gt; &quot;goodbye&quot;
f2.x  =&gt; &quot;goodbye&quot;;
</code></pre></div></li>
</ul>

<h3>其他信息</h3>

<p>根据上面的对象关系图，配合在 javascript 终端验证，可以得出更有意思的结论：</p>

<ul>
<li><p><code>Function.__proto__</code> 指向 <code>Function.prototype</code>，所以：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">Function.constructor === Function
</code></pre></div></li>
<li><p>Object instanceof Object == true， 因为：</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">Object.__proto__.__proto__.constructor == Object
</code></pre></div></li>
</ul>

<p>但是</p>

<p>Foo instanceof Foo == false，因为在 Foo 的原型链上找不到符合上面的那种关系</p>

<h3>附录 &amp;&amp; 链接</h3>

<ol>
<li><a href="/images/javascript-prototype-chain.png">对象模型的另外一种表示法</a></li>
<li><a href="http://mollypages.org/misc/js.mp">javascript object layout &amp;&amp; prototype chain</a></li>
</ol>


    
    <h3>标签 : </h3>
    <p class="tags">
        
        <a href="/tags/Javascript/">Javascript</a>
        
    </p>
    

    <div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'lyfblog'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>


    <div class="footer">
        <div class="contact">
            <p>
                YifengLiu<br/>
                software engineer<br/>
            </p>
        </div>
        <div class="contact">
            <p>
                <a href="https://github.com/lyfshadyboss">github.com/lyfshadyboss</a><br/>
                <a href="https://twitter.com/lyfshadyboss">twitter.com/lyfshadyboss</a><br/>
            </p>
        </div>
    </div>
</div>

</body>
</html>
